#!/bin/sh

usage='Usage: ./configure [option] ...
Use the option "--help" to list the available options.
'

help='Usage: ./configure [option] ...

Available options:

  --opamprefixdir=DIR         set the directory of your instaleed opam

  --help                      show this help
'

while : ; do
    case "$1" in
        --opamprefixdir=*)
            opamprefixdir="${1#*=}" ;;
        -opamprefixdir|--opamprefixdir)
            opamprefixdir="$2" ; shift ;;
        "")
            # End of arguments
            break ;;
        -help|--help)
            echo "$help" ; exit 0 ;;
        -*)
            echo "Unknown option: $1" ; echo "$usage" ; exit 1 ;;
    esac
    shift
done

# generate Makefile.config

cat > Makefile.config << EOF
DXDIR := $opamprefixdir/lib/coq/user-contrib/dx
COMPCERTDIR := $opamprefixdir/lib/coq-variant/compcert32/compcert
CLIGHTGEN32DIR := $opamprefixdir/variants/compcert32/bin
COMPCERTSRCDIR := $opamprefixdir/.opam-switch/build/coq-compcert-32.3.9
EOF

# generate the CoqProject file
make CoqProject

echo "The following configuration was saved in Makefile.config:"
echo
cat Makefile.config
